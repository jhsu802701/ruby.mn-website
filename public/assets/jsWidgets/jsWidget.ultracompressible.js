/*
 * Javascript Widget Engine v0.0.1
 *
 * Copyright 2009-2010, Subramaya Sastry
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Date: Tue Mar 30 11:00:00 AM CT
 */
/* ***********************************************************************
 * NOTES: 
 * For enabling code compression, use local variables as much as possible.
 * This is the reason why you see a lot of copies of global variables
 * and object properties into local variables in the js code below with a corresponding comment
 * ************************************************************************/
// Test for whether a variable is defined
function _GLOB_isDefined(a){return typeof a!="undefined"}function _GLOB_iterateOverArray(a,b){var c=a.length;for(var d=0;d<c;d++)b(a[d])}function _Widget(a){this.wf=a,this.baseUrl=a.base_url,this.rootDIV="",this.init(),_GLOB_isDefined(this.baseUrl)||(this.baseUrl="")}_Widget.prototype={init:function(){var a=this,b=a.wf,c=b.base_css_prefs;a.hoverStyle=c.link_class||!_GLOB_isDefined(c.link_hover_style)?"":c.link_hover_style},_PRIV_setStyle:function(a,b,c){var d=this,e=d.wf.base_css_prefs;b?a.setAttribute(document.all?"className":"class",b):c?a.style.setAttribute?(a.style.setAttribute("cssText",c),a.tagName=="A"&&d.hoverStyle&&(a.onmouseover=function(){this.style.setAttribute("cssText",c+";"+d.hoverStyle)},a.onmouseout=function(){this.style.setAttribute("cssText",c)})):(a.setAttribute("style",c),a.tagName=="A"&&d.hoverStyle&&(a.onmouseover=function(){this.setAttribute("style",c+";"+d.hoverStyle)},a.onmouseout=function(){this.setAttribute("style",c)})):a.tagName=="A"&&(e.link_style||e.link_class)&&d._PRIV_setStyle(a,e.link_class,e.link_style)},_PRIV_createElement:function(a,b,c){var d=document.createElement(a);return this._PRIV_setStyle(d,b,c),d},_PRIV_computeExpr:function(str,dataObj){function fetchExprValue(w,d,vRef){return eval(vRef.substring(1,vRef.length-1).replace(/\$util\./g,"w.helpers.").replace(/\$/g,"d"))}var widget=this,widgetFormat=this.wf,refs=str.match(/\{.*?\}/g);return refs&&_GLOB_iterateOverArray(refs,function(a){str=str.replace(a,fetchExprValue(widget,dataObj,a))}),str},_PRIV_processNewDOMElement:function(a,b,c,d,e,f){var g=this,h=g.wf.base_css_prefs,i=g.baseUrl;if(!d)d=document.createTextNode(b);else if(d.tagName=="IMG"){var j=e&&e.src?g._PRIV_computeExpr(e.src,a):i;j.indexOf("http://")==-1&&(j=i+j),d.src=j,d.alt=b}else if(d.tagName!="A")f&&(d.innerHTML=b);else{var k=e&&e.url?g._PRIV_computeExpr(e.url,a):i;k.indexOf("http://")==-1&&(k=i+k),d.href=k,d.target=h.link_target;if(f){var l=e&&e.text?e.text:b;d.innerHTML=g._PRIV_computeExpr(l,a)}!e.clazz&&!e.style&&g._PRIV_setStyle(d,h.link_class,h.link_style)}return d},_PRIV_buildDataElementContainer:function(a,b,c){var d=this,e="",f="",g=_GLOB_isDefined(c.how)?c.how:[],h=g.length;for(var i=0;i<h;i++){var j,k=g[i],l;k.elt=="dom_tree"?(l=d._PRIV_buildWidgetSectionDOM(k.root_elt,a,k),this._PRIV_processNewDOMElement(a,"",[],l,k,!1)):(l=this._PRIV_createElement(k.elt,k.clazz,k.style),j=i==h-1,this._PRIV_processNewDOMElement(a,b,c,l,k,j)),e?f.appendChild(l):e=l,f=l}return h==0&&(e=this._PRIV_processNewDOMElement(a,b,c,"",k,!0)),e},_PRIV_addSeparator:function(a,b){b&&(b.substring(0,1)=="\n"&&(a.appendChild(document.createElement("br")),b=b.substring(1)),b&&a.appendChild(document.createTextNode(b)))},_PRIV_addDataElement:function(a,b,c){var d=this,e=_GLOB_isDefined(b.what)?b.what:"";if(_GLOB_isDefined(b.if_true)){var f=d._PRIV_computeExpr(b.if_true,a);if(f=="undefined"||!f)return}if(e){var g=d._PRIV_computeExpr(e,a);if(!g)return}b.prefix&&d._PRIV_addSeparator(c,b.prefix);var h=d._PRIV_buildDataElementContainer(a,g,b);h&&c.appendChild(h),b.suffix&&d._PRIV_addSeparator(c,b.suffix)},_PRIV_buildWidgetSectionChildren:function(a,b,c){var d=this;_GLOB_iterateOverArray(b,function(b){d._PRIV_addDataElement(a,b,c)})},_PRIV_buildWidgetSectionDOM:function(a,b,c){var d=this._PRIV_createElement(a,c.clazz,c.style);return this._PRIV_buildWidgetSectionChildren(b,c.dom_nodes,d),d},_PRIV_buildWidgetSection:function(sectionFormat){var secData=eval(sectionFormat.data);if(sectionFormat.loop){var secDIV=this._PRIV_createElement("div","",""),count=0,numReqdItems=sectionFormat.num_items,l=secData.length;for(var i=0;i<l;i++){if(count==numReqdItems)break;secDIV.appendChild(this._PRIV_buildWidgetSectionDOM("div",secData[i],sectionFormat)),count++}return secDIV}return this._PRIV_buildWidgetSectionDOM("div",secData,sectionFormat)},_PRIV_generateWidgetDiv:function(){var a=this,b=a.baseUrl,c=a.wf,d=c.base_css_prefs,e=a._PRIV_createElement("div",d.clazz,d.style);return _GLOB_iterateOverArray(c.sections,function(b){e.appendChild(a._PRIV_buildWidgetSection(c[b]))}),a.rootDIV=e,e},installOver:function(a){a.parentNode.replaceChild(this._PRIV_generateWidgetDiv(),a)},refresh:function(){this.installOver(this.rootDIV)},helpers:{_PRIV_truncateTextChars:function(a,b,c,d){if(!a||a.length<=b)return a;a=a.substring(0,b);var e=a.lastIndexOf(d);return e>c?a=a.substring(0,e):d!=" "&&(e=a.lastIndexOf(" "),e>c&&(a=a.substring(0,e))),a+" ..."},_PRIV_smartTruncate:function(a,b){return this._PRIV_truncateTextChars(a,b,b-15," ")},trimString:function(a,b){return b?this._PRIV_smartTruncate(a,b):a},formatDate:function(a,b,c,d){function f(a,b){b=String(b).replace(/^0/,""),a.m=b,a.mm=b<10?"0"+b:b,a.MM=e[b-1],a.M=e[b-1].substr(0,3)}function g(a,b){b=String(b).replace(/^0/,""),a.d=b,a.dd=b<10?"0"+b:b}var e=["January","February","March","April","May","June","July","August","September","October","November","December"];if(!c||!d)return a;var h=c.split(b),j=a.split(b),k={},l=h.length;for(i=0;i<l;i++)k[h[i]]=j[i];if(k.m||k.mm)f(k,k.m?k.m:k.mm);else if(k.MM){for(i=0;i<12;i++)if(e[i]==k["MM"]){f(k,i+1);break}}else if(k.M)for(i=0;i<12;i++)if(e[i].substr(0,3)==k["M"]){f(k,i+1);break}g(k,k.d?k.d:k.dd);var m=["y","dd","d","mm","m","MM","M"],n=d,l=m.length;for(i=0;i<l;i++)n=n.replace(m[i],k[m[i]]);return n}}}